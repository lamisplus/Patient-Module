<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">

    <property name="autoIncrement" value="true"/>

    <changeSet id="202220421-001" author="amos-data-fi">
        <sql>
            CREATE TABLE person
            (
                id                         BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                created_date               TIMESTAMP WITHOUT TIME ZONE,
                created_by                 VARCHAR(255),
                last_modified_date         TIMESTAMP WITHOUT TIME ZONE,
                last_modified_by           VARCHAR(255),
                active                     BOOLEAN                                 NOT NULL,
                contact_point              JSONB,
                address                    JSONB,
                gender                     JSONB,
                identifier                 JSONB,
                deceased                   BOOLEAN,
                deceased_date_time         TIMESTAMP WITHOUT TIME ZONE,
                marital_status             JSONB,
                employment_status          JSONB,
                education                  JSONB,
                organization               JSONB,
                contact                    JSONB,
                date_of_birth              date                                    NOT NULL,
                date_of_registration       date                                    NOT NULL,
                archived                   INTEGER,
                facility_id                BIGINT,
                uuid                       VARCHAR(255),
                first_name                 VARCHAR(255),
                surname                    VARCHAR(255),
                other_name                 VARCHAR(255),
                is_date_of_birth_estimated BOOLEAN,
                CONSTRAINT pk_person PRIMARY KEY (id)
            );
        </sql>
    </changeSet>

    <changeSet id="20221705-002" author="amos-data-fi">
        <sql>
            CREATE TABLE visit
            (
                id                 BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                created_date       TIMESTAMP WITHOUT TIME ZONE,
                created_by         VARCHAR(255),
                last_modified_date TIMESTAMP WITHOUT TIME ZONE,
                last_modified_by   VARCHAR(255),
                facility_id        BIGINT,
                person_id          BIGINT                                  NOT NULL,
                visit_start_date   date                                    NOT NULL,
                visit_end_date     date,
                uuid               VARCHAR(255)                            NOT NULL,
                archived           INTEGER,
                CONSTRAINT pk_visit PRIMARY KEY (id)
            );

            ALTER TABLE visit
                ADD CONSTRAINT FK_VISIT_ON_PERSON FOREIGN KEY (person_id) REFERENCES person (id);
        </sql>
    </changeSet>

    <changeSet id="20221705-004" author="amos-data-fi">

        <sql>
            CREATE TABLE encounter
            (
                id                 BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                created_date       TIMESTAMP WITHOUT TIME ZONE,
                created_by         VARCHAR(255),
                last_modified_date TIMESTAMP WITHOUT TIME ZONE,
                last_modified_by   VARCHAR(255),
                facility_id        BIGINT,
                encounter_date     date                                    NOT NULL,
                person_id          BIGINT                                  NOT NULL,
                uuid               VARCHAR(255)                            NOT NULL,
                visit_id           BIGINT                                  NOT NULL,
                service_code       VARCHAR(255)                            NOT NULL,
                status             VARCHAR(255)                            NOT NULL,
                archived           INTEGER,
                CONSTRAINT pk_encounter PRIMARY KEY (id)
            );

            ALTER TABLE encounter
                ADD CONSTRAINT FK_ENCOUNTER_ON_PERSON FOREIGN KEY (person_id) REFERENCES person (id);

            ALTER TABLE encounter
                ADD CONSTRAINT FK_ENCOUNTER_ON_VISIT FOREIGN KEY (visit_id) REFERENCES visit (id);
        </sql>
    </changeSet>
    <changeSet id="20222005-005" author="amos-data-fi">
        <sql>
            CREATE TABLE patient_check_post_service
            (
                id                  BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                facility_id         BIGINT,
                module_service_code VARCHAR(255),
                module_service_name VARCHAR(255),
                encounter_type      VARCHAR(255),
                CONSTRAINT pk_patient_check_post_service PRIMARY KEY (id)
            );
        </sql>
    </changeSet>
    <changeSet id="20220306-006" author="amos-data-fi">
        <sql>
            CREATE TABLE biometric
            (
                id                 VARCHAR(255) NOT NULL,
                created_date       TIMESTAMP WITHOUT TIME ZONE,
                created_by         VARCHAR(255),
                last_modified_date TIMESTAMP WITHOUT TIME ZONE,
                last_modified_by   VARCHAR(255),
                facility_id        BIGINT,
                person_id          BIGINT       NOT NULL,
                template           OID,
                biometric_type     VARCHAR(255),
                template_type      VARCHAR(255),
                enrollment_date    date,
                archived           BOOLEAN,
                iso                BOOLEAN,
                extra              JSONB,
                CONSTRAINT pk_biometric PRIMARY KEY (id)
            );

            ALTER TABLE biometric
                ADD CONSTRAINT FK_BIOMETRIC_ON_PERSON FOREIGN KEY (person_id) REFERENCES person (id);
        </sql>
    </changeSet>
</databaseChangeLog>
